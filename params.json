{"name":"Yapo","tagline":"Yet Another PHP ORM","body":"Yapo\r\n====\r\n\r\nYet Another PHP ORM\r\n\r\n[![Latest Stable Version](https://poser.pugx.org/yapo/yapo/v/stable.png)](https://packagist.org/packages/yapo/yapo)\r\n[![Build Status](https://travis-ci.org/zealotrunner/Yapo.png?branch=master)](https://travis-ci.org/zealotrunner/Yapo)\r\n[![Coverage Status](https://coveralls.io/repos/zealotrunner/Yapo/badge.png)](https://coveralls.io/r/zealotrunner/Yapo)\r\n[![License](https://poser.pugx.org/yapo/yapo/license.png)](https://packagist.org/packages/yapo/yapo)\r\n\r\n\r\nUsage\r\n-----\r\n\r\n```php\r\n$_ = Company::_();\r\n\r\n\r\n$company = Company::get(10);        // SELECT * FROM `company` WHERE `id` = 10\r\n\r\n\r\n$companies = Company::filter(       // SELECT * FROM `company`\r\n    $_('name')->like('%oo%'),       // WHERE ( `name` LIKE '%oo%'\r\n    $_('is_public')->eq(true)       // AND `is_pubilc` = 1 )\r\n)->or(\r\n    $_('employees')->gt('10000')    // OR ( `employees` > 10000 )\r\n);\r\n\r\n\r\nforeach ($companies as $company) {\r\n    echo $company->name;\r\n    echo $company->ceo->name;       // SELECT * FROM `employee` WHERE \r\n                                    // `id` = {$company->ceo}\r\n    echo $company->ceo->sex->text();\r\n}\r\n\r\n\r\n$companies_ceo_born_after_1972 = Company::filter(\r\n    $_('ceo')->_('born')->gt(1972)\r\n\r\n    // SELECT `id` FROM `company` WHERE ( `ceo_id` \r\n    //     IN (SELECT `id` FROM `employee` WHERE `born` > '1972'))\r\n);\r\n\r\n```\r\n\r\nModel Definition\r\n----------------\r\n```php\r\nclass Company extends Yapo\\Yapo {\r\n\r\n    public static function table() {\r\n        return 'CompanyTable';\r\n    }\r\n\r\n    protected static function define_fields($define) {\r\n\r\n        $define('name')             ->as('name'); // ->of('CompanyTable');\r\n\r\n        $define('founded')          ->as('founded'); // ->of('CompanyTable');\r\n\r\n        $define('symbol')           ->as('nasdaq_symbol'); // ->of('CompanyTable');\r\n\r\n        $define('description')      ->as('description')->of('CompanyDetailTable')\r\n                                    ->using('id');\r\n\r\n        $define('ceo')              ->as('Employee')\r\n                                    ->using('ceo');\r\n\r\n        $define('employees')        ->as('Employee')\r\n                                    ->with('company');\r\n\r\n        $define('brief')            ->as(function($row) {\r\n                                        return \"{$row['name']}, founded in {$row['founded']}.\";\r\n                                    }); // ->of('CompanyTable');\r\n\r\n        $define('special')          ->as('special')->switch(array(\r\n                                        '0' => 'Company',\r\n                                        '1' => 'SpecialCompany'\r\n                                    ));\r\n    }\r\n\r\n    // define instance methods\r\n    public function introduce() {\r\n        return $this->brief;\r\n    }\r\n\r\n}\r\n\r\n/*\r\n * SpecialCompany is a submodel\r\n */\r\nclass SpecialCompany extends Company {\r\n\r\n    protected static function define_fields($define) {\r\n        // inherit all fields defined in Company\r\n\r\n        $define('why')          ->as('why')->of('SpecialCompanyTable')\r\n                                ->using('id');\r\n\r\n    }\r\n\r\n    // overwrite Company::introduce()\r\n    public function introduce() {\r\n        return \"[{$this->why}] {$this->brief}\";\r\n    }\r\n}\r\n```\r\n\r\n```php\r\nclass Employee extends Yapo\\Yapo {\r\n\r\n    public static function table() {\r\n        return 'EmployeeTable';\r\n    }\r\n\r\n    protected static function define_fields($define) {\r\n\r\n        $define('name')             ->as('name');\r\n\r\n        $define('sex')              ->as('sex')\r\n                                    ->enum(array(\r\n                                        0 => '?',\r\n                                        1 => 'Male',\r\n                                        2 => 'Female'\r\n                                    ));\r\n\r\n        $define('company')          ->as('Company')->using('company_id');\r\n    }\r\n\r\n}\r\n```\r\n\r\n```php\r\nclass CompanyTable extends Yapo\\YapoTable {\r\n\r\n    public static function master() {\r\n        return new Yapo\\YapoConfig(\r\n            $dsn      = TEST_DSN,\r\n            $user     = TEST_USER,\r\n            $password = TEST_PASS,\r\n            $table    = 'company',\r\n            $pk       = 'id'\r\n        );\r\n    }\r\n}\r\n\r\nclass CompanyDetailTable extends Yapo\\YapoTable {\r\n\r\n    public static function master() {\r\n        return new Yapo\\YapoConfig(\r\n            $dsn      = TEST_DSN,\r\n            $user     = TEST_USER,\r\n            $password = TEST_PASS,\r\n            $table    = 'company_detail',\r\n            $pk       = 'id'\r\n        );\r\n    }\r\n}\r\n\r\nclass SpecialCompanyTable extends Yapo\\YapoCachedTable {\r\n\r\n    public static function master() {\r\n        return new Yapo\\YapoConfig(\r\n            $dsn      = TEST_DSN,\r\n            $user     = TEST_USER,\r\n            $password = TEST_PASS,\r\n            $table    = 'special_company',\r\n            $pk       = 'id'\r\n        );\r\n    }\r\n}\r\n\r\nclass EmployeeTable extends Yapo\\YapoTable {\r\n\r\n    public static function master() {\r\n        return new Yapo\\YapoConfig(\r\n            $dsn      = TEST_DSN,\r\n            $user     = TEST_USER,\r\n            $password = TEST_PASS,\r\n            $table    = 'employee',\r\n            $pk       = 'id'\r\n        );\r\n    }\r\n}\r\n\r\n```\r\n\r\n\r\n---\r\n\r\n1. local fields\r\n\r\n        $define('symbol')       ->as('n_symbol');\r\n\r\n            Company\r\n        ---------------\r\n        |             |\r\n        |  *n_symbol* |\r\n        |             |\r\n        ---------------\r\n\r\n2. another model as a field\r\n\r\n        //\r\n        $define('ceo')          ->as('Employee')\r\n                                ->using('ceo_id');\r\n\r\n            Company           *Employee*\r\n        ---------------     --------------\r\n        |             |     |            |\r\n        |    ceo_id   | - > |            |\r\n        |             |     |            |\r\n        ---------------     --------------\r\n\r\n        //\r\n        $define('employees')    ->as('Employee')\r\n                                ->with('company');\r\n\r\n            Company           *Employee*\r\n        ---------------     --------------\r\n        |             |     |            |\r\n        |             | < - |  company   |\r\n        |             |     |            |\r\n        ---------------     --------------\r\n\r\n3. another column as a field\r\n\r\n        //\r\n        $define('description')  ->as('description')\r\n                                ->of('CompanyDetailTable')\r\n                                ->using('id');\r\n\r\n           Company           CompanyDetailTable\r\n        ---------------     -------------------\r\n        |             |     |                 |\r\n        |     id      | - > |  *description*  |\r\n        |             |     |                 |\r\n        ---------------     -------------------\r\n\r\n        // ...\r\n\r\nTest\r\n----\r\n\r\nInstall [Composer](https://github.com/composer/composer)\r\n```shell\r\ncd yapo\r\ncurl -sS https://getcomposer.org/installer | php\r\nphp composer.phar install --dev\r\nphp composer.phar dumpautoload -o\r\n```\r\n\r\nPrepare for testing\r\n```shell\r\n./tests/generate_test_sqlite\r\n```\r\n\r\nTest\r\n```shell\r\n./vendor/bin/phpunit tests/YapoTest.php\r\n```\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}